<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Pp (melange.Pp)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="canonical" href="https://melange.re/v5.0.0/api/re/melange/Pp/index.html" /></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">melange</a> &#x00BB; Pp</nav><header class="odoc-preamble"><h1>Module <code><span>Pp</span></code></h1><p>Pretty-printing.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#basic-combinators">Basic combinators</a></li><li><a href="#break-hints">Break hints</a></li><li><a href="#boxes">Boxes</a></li><li><a href="#tags">Tags</a></li><li><a href="#convenience-functions">Convenience functions</a></li><li><a href="#operators">Operators</a></li><li><a href="#rendering">Rendering</a></li><li><a href="#ast">Ast</a></li><li><a href="#comparison">Comparison</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t(+'tag)</span><span>;</span></code></div><div class="spec-doc"><p><code>'tag t</code> represents a document that is not yet rendered. The argument <code>'tag</code> is the type of tags in the document. For instance tags might be used for styles.</p><p>If you want to serialise and deserialise this datastructure, you can use the <code>Ast.t</code> type together with the <code>of_ast</code> and <code>to_ast</code> functions.</p></div></div><h2 id="basic-combinators"><a href="#basic-combinators" class="anchor"></a>Basic combinators</h2><div class="odoc-spec"><div class="spec value anchored" id="val-nop"><a href="#val-nop" class="anchor"></a><code><span><span class="keyword">let</span> nop: <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>A pretty printer that prints nothing</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-seq"><a href="#val-seq" class="anchor"></a><code><span><span class="keyword">let</span> seq: <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>seq x y</code> prints <code>x</code> and then <code>y</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-concat"><a href="#val-concat" class="anchor"></a><code><span><span class="keyword">let</span> concat: <span><span class="optlabel">?sep</span>:<a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <span>list(<a href="#type-t">t</a>(<span class="type-var">'tag</span>)) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>concat ?sep l</code> prints elements in <code>l</code> separated by <code>sep</code>. <code>sep</code> defaults to <code>nop</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-concat_map"><a href="#val-concat_map" class="anchor"></a><code><span><span class="keyword">let</span> concat_map: <span><span class="optlabel">?sep</span>:<a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <span>list(<span class="type-var">'a</span>) <span class="arrow">=&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Convenience function for <code>List.map</code> followed by <code>concat</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-concat_mapi"><a href="#val-concat_mapi" class="anchor"></a><code><span><span class="keyword">let</span> concat_mapi: 
  <span><span class="optlabel">?sep</span>:<a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span>
  <span>list(<span class="type-var">'a</span>) <span class="arrow">=&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span>int <span class="arrow">=&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span>
  <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Convenience function for <code>List.mapi</code> followed by <code>concat</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verbatim"><a href="#val-verbatim" class="anchor"></a><code><span><span class="keyword">let</span> verbatim: <span>string <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>An indivisible block of text.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verbatimf"><a href="#val-verbatimf" class="anchor"></a><code><span><span class="keyword">let</span> verbatimf: <span><span class="xref-unresolved">Stdlib</span>.format4<span>(<span class="type-var">'a</span>, unit, string, <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <span class="type-var">'a</span>;</span></code></div><div class="spec-doc"><p>Same as <code>verbatim</code> but take a format string as argument.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-char"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">let</span> char: <span>char <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>A single character.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-text"><a href="#val-text" class="anchor"></a><code><span><span class="keyword">let</span> text: <span>string <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Print a bunch of text. The line may be broken at any spaces in the text.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-textf"><a href="#val-textf" class="anchor"></a><code><span><span class="keyword">let</span> textf: <span><span class="xref-unresolved">Stdlib</span>.format4<span>(<span class="type-var">'a</span>, unit, string, <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <span class="type-var">'a</span>;</span></code></div><div class="spec-doc"><p>Same as <code>text</code> but take a format string as argument.</p></div></div><h2 id="break-hints"><a href="#break-hints" class="anchor"></a>Break hints</h2><div class="odoc-spec"><div class="spec value anchored" id="val-space"><a href="#val-space" class="anchor"></a><code><span><span class="keyword">let</span> space: <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>space</code> instructs the pretty-printing algorithm that the line may be broken at this point. If the algorithm decides not to break the line, a single space will be printed instead.</p><p>So for instance <code>verbatim &quot;x&quot; ++ space ++ verbatim &quot;y&quot;</code> might produce &quot;x y&quot; or &quot;x\n&lt;indentation&gt;y&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cut"><a href="#val-cut" class="anchor"></a><code><span><span class="keyword">let</span> cut: <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>cut</code> instructs the pretty-printing algorithm that the line may be broken at this point. If the algorithm decides not to break the line, nothing is printed instead.</p><p>So for instance <code>verbatim &quot;x&quot; ++ cut ++ verbatim &quot;y&quot;</code> might produce &quot;xy&quot; or &quot;x\n&lt;indentation&gt;y&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-break"><a href="#val-break" class="anchor"></a><code><span><span class="keyword">let</span> break: <span><span class="label">nspaces</span>:int <span class="arrow">=&gt;</span></span> <span><span class="label">shift</span>:int <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>break</code> is a generalisation of <code>space</code> and <code>cut</code>. It also instructs the pretty-printing algorithm that the line may be broken at this point. If it ends up being broken, <code>shift</code> will be added to the indentation level, otherwise <code>nspaces</code> spaces will be printed. <code>shift</code> can be negative, in which case the indentation will be reduced.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-custom_break"><a href="#val-custom_break" class="anchor"></a><code><span><span class="keyword">let</span> custom_break: 
  <span><span class="label">fits</span>:<span>(string, int, string)</span> <span class="arrow">=&gt;</span></span>
  <span><span class="label">breaks</span>:<span>(string, int, string)</span> <span class="arrow">=&gt;</span></span>
  <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>custom_break ~fits:(a, b, c) ~breaks:(x, y, z)</code> is a generalisation of <code>break</code>. It also instructs the pretty-printing algorithm that the line may be broken at this point. If it ends up being broken, <code>x</code> is printed, the line breaks, <code>y</code> will be added to the indentation level and <code>z</code> is printed, otherwise <code>a</code> will be printed, <code>b</code> spaces are printed and then <code>c</code> is printed. The indentation <code>y</code> can be negative, in which case the indentation will be reduced.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-newline"><a href="#val-newline" class="anchor"></a><code><span><span class="keyword">let</span> newline: <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Force a newline to be printed. Usage is discourage since it breaks printing with boxes. If you need to add breaks to your text, put your items into <code>box</code>es and <code>concat</code> with a separating <code>space</code> afterwhich wrapping it in a <code>vbox</code>.</p></div></div><h2 id="boxes"><a href="#boxes" class="anchor"></a>Boxes</h2><p>Boxes are the basic components to control the layout of the text. Break hints such as <code>space</code> and <code>cut</code> may cause the line to be broken, depending on the splitting rules. Whenever a line is split, the rest of the material printed in the box is indented with <code>indent</code>.</p><p>You can think of a box with indentation as something with this shape:</p><pre>   ######################### &lt;- first line
   &lt;indent&gt;#################
   &lt;indent&gt;#################
   &lt;indent&gt;#################
   &lt;indent&gt;#################</pre><p>And the top left corner of this shape is anchored where the box was declared. So for instance, the following document:</p><pre class="language-ocaml"><code>  Pp.verbatim &quot;.....&quot; ++ Pp.box ~indent:2 (Pp.text &quot;some long ... text&quot;)</code></pre><p>would produce:</p><pre>   .....some long ...
          text</pre><div class="odoc-spec"><div class="spec value anchored" id="val-box"><a href="#val-box" class="anchor"></a><code><span><span class="keyword">let</span> box: <span><span class="optlabel">?indent</span>:int <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Try to put as much as possible on each line. Additionally, a break hint always break the line if the breaking would reduce the indentation level inside the box (<code>break</code> with negative <code>shift</code> value).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-vbox"><a href="#val-vbox" class="anchor"></a><code><span><span class="keyword">let</span> vbox: <span><span class="optlabel">?indent</span>:int <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Always break the line when encountering a break hint.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hbox"><a href="#val-hbox" class="anchor"></a><code><span><span class="keyword">let</span> hbox: <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Print everything on one line, no matter what</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hvbox"><a href="#val-hvbox" class="anchor"></a><code><span><span class="keyword">let</span> hvbox: <span><span class="optlabel">?indent</span>:int <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>If possible, print everything on one line. Otherwise, behave as a <code>vbox</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hovbox"><a href="#val-hovbox" class="anchor"></a><code><span><span class="keyword">let</span> hovbox: <span><span class="optlabel">?indent</span>:int <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p>Try to put as much as possible on each line. Basically the same as <code>box</code> but without the rule about breaks with negative <code>shift</code> value.</p></div></div><h2 id="tags"><a href="#tags" class="anchor"></a>Tags</h2><p>Tags are arbitrary pieces of information attached to a document. They can be used to add styles to pretty-printed text, for instance to print to the terminal with colors.</p><div class="odoc-spec"><div class="spec value anchored" id="val-tag"><a href="#val-tag" class="anchor"></a><code><span><span class="keyword">let</span> tag: <span><span class="type-var">'tag</span> <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>tag x t</code> Tag the material printed by <code>t</code> with <code>x</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_tags"><a href="#val-map_tags" class="anchor"></a><code><span><span class="keyword">let</span> map_tags: <span><a href="#type-t">t</a>(<span class="type-var">'from_tag</span>) <span class="arrow">=&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'from_tag</span> <span class="arrow">=&gt;</span></span> <span class="type-var">'to_tag</span>)</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'to_tag</span>);</span></code></div><div class="spec-doc"><p>Convert tags in a documents</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-filter_map_tags"><a href="#val-filter_map_tags" class="anchor"></a><code><span><span class="keyword">let</span> filter_map_tags: 
  <span><a href="#type-t">t</a>(<span class="type-var">'from_tag</span>) <span class="arrow">=&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><span class="type-var">'from_tag</span> <span class="arrow">=&gt;</span></span> option(<span class="type-var">'to_tag</span>))</span> <span class="arrow">=&gt;</span></span>
  <a href="#type-t">t</a>(<span class="type-var">'to_tag</span>);</span></code></div><div class="spec-doc"><p>Convert tags in a documents, possibly removing some tags.</p></div></div><h2 id="convenience-functions"><a href="#convenience-functions" class="anchor"></a>Convenience functions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-paragraph"><a href="#val-paragraph" class="anchor"></a><code><span><span class="keyword">let</span> paragraph: <span>string <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>paragraph s</code> is <code>hovbox (text s)</code>. This is useful to preserve the structure of a paragraph of text without worrying about it being broken by a <code>vbox</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-paragraphf"><a href="#val-paragraphf" class="anchor"></a><code><span><span class="keyword">let</span> paragraphf: <span><span class="xref-unresolved">Stdlib</span>.format4<span>(<span class="type-var">'a</span>, unit, string, <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <span class="type-var">'a</span>;</span></code></div><div class="spec-doc"><p><code>paragraphf s</code> is <code>textf s</code> followed by a <code>hovbox</code>. The <code>textf</code> version of <code>paragraph</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enumerate"><a href="#val-enumerate" class="anchor"></a><code><span><span class="keyword">let</span> enumerate: <span>list(<span class="type-var">'a</span>) <span class="arrow">=&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>enumerate l ~f</code> produces an enumeration of the form:</p><pre>  - item1
  - item2
  - item3
  ...</pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chain"><a href="#val-chain" class="anchor"></a><code><span><span class="keyword">let</span> chain: <span>list(<span class="type-var">'a</span>) <span class="arrow">=&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>))</span> <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>chain l ~f</code> is used to print a succession of items that follow each other. It produces an output of this form:</p><pre>     item1
  -&gt; item2
  -&gt; item3
  ...</pre></div></div><h2 id="operators"><a href="#operators" class="anchor"></a>Operators</h2><div class="odoc-spec"><div class="spec module anchored" id="module-O"><a href="#module-O" class="anchor"></a><code><span><span class="keyword">module</span> <a href="O/index.html">O</a></span><span>: { ... }</span><span>;</span></code></div><div class="spec-doc"><p>Infix operators for <code>Pp.t</code></p></div></div><h2 id="rendering"><a href="#rendering" class="anchor"></a>Rendering</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_fmt"><a href="#val-to_fmt" class="anchor"></a><code><span><span class="keyword">let</span> to_fmt: <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> unit;</span></code></div><div class="spec-doc"><p>Render a document to a classic formatter</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_fmt_with_tags"><a href="#val-to_fmt_with_tags" class="anchor"></a><code><span><span class="keyword">let</span> to_fmt_with_tags: 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">=&gt;</span></span>
  <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span>
  <span><span class="label">tag_handler</span>:<span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">=&gt;</span></span> <span><span class="type-var">'tag</span> <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> unit)</span> <span class="arrow">=&gt;</span></span>
  unit;</span></code></div></div><h2 id="ast"><a href="#ast" class="anchor"></a>Ast</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Ast"><a href="#module-Ast" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ast/index.html">Ast</a></span><span>: { ... }</span><span>;</span></code></div><div class="spec-doc"><p>Stable representation of <code>Pp.t</code> useful for serialization</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_ast"><a href="#val-of_ast" class="anchor"></a><code><span><span class="keyword">let</span> of_ast: <span><a href="Ast/index.html#type-t">Ast.t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="#type-t">t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>of_ast t</code> converts an <code>Ast.t</code> to a <code>Pp.t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_ast"><a href="#val-to_ast" class="anchor"></a><code><span><span class="keyword">let</span> to_ast: <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <a href="Ast/index.html#type-t">Ast.t</a>(<span class="type-var">'tag</span>);</span></code></div><div class="spec-doc"><p><code>to_ast t</code> converts a <code>Pp.t</code> to an <code>Ast.t</code>.</p></div></div><h2 id="comparison"><a href="#comparison" class="anchor"></a>Comparison</h2><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">let</span> compare: <span><span>(<span><span class="type-var">'tag</span> <span class="arrow">=&gt;</span></span> <span><span class="type-var">'tag</span> <span class="arrow">=&gt;</span></span> int)</span> <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> <span><a href="#type-t">t</a>(<span class="type-var">'tag</span>) <span class="arrow">=&gt;</span></span> int;</span></code></div><div class="spec-doc"><p><code>compare cmp x y</code> compares <code>x</code> and <code>y</code> using <code>cmp</code> to compare tags.</p></div></div></div></body></html>
